<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Optional: You can customize Tailwind here if needed
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: { // Custom primary color matching your old theme
                DEFAULT: '#3b82f6', // blue-500
                dark: '#2563eb',   // blue-600
                light: '#60a5fa',  // blue-400
              },
            }
          }
        }
      }
    </script>
    <style>
      /* For any minor custom styles Tailwind doesn't cover easily */
      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji",
          "Segoe UI Emoji", "Segoe UI Symbol";
        padding-top: 60px; /* Corresponds to nav-height */
      }
      /* Custom transition for results section if needed beyond Tailwind's capabilities */
      .results-transition {
        transition: opacity 0.5s ease-out, transform 0.5s ease-out;
      }
      .input-number-placeholder::placeholder { /* For more specific number placeholder styling if needed */
        color: #9ca3af; /* Tailwind gray-400 */
      }
    </style>
  </head>
  <body class="bg-gray-100 text-gray-800 antialiased">
    <!-- Navigation Bar -->
    <nav class="fixed top-0 left-0 w-full h-[60px] bg-primary shadow-md flex items-center justify-between px-4 sm:px-8 z-50">
      <a href="https://witchakornb.github.io/" class="text-white text-xl sm:text-2xl font-semibold hover:opacity-80 transition-opacity">SmartPrice</a>
      <ul class="flex space-x-4 sm:space-x-6">
        <li>
          <a href="https://witchakornb.github.io/witchakornb/" target="_blank" class="text-white text-sm sm:text-base hover:text-primary-light transition-colors">
            witchakornb.io
          </a>
        </li>
        <li>
          <a href="https://witchakornb.github.io/24-game-solver/" target="_blank" class="text-white text-sm sm:text-base hover:text-primary-light transition-colors">
            24 Game Solver
          </a>
        </li>
      </ul>
    </nav>

    <div class="container max-w-3xl mx-auto p-4 mt-8 mb-8">
      <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-br from-primary to-primary-dark text-white text-center p-6 sm:p-8">
          <h1 class="text-2xl sm:text-3xl font-bold mb-2">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤</h1>
          <p class="text-base sm:text-lg opacity-90">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏´‡πá‡∏ô‡πÜ</p>
        </div>

        <div class="p-6 sm:p-8">
          <div id="errorMessageArea" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-6 hidden" role="alert">
            {/* Error messages will appear here */}
          </div>

          <div class="product-list space-y-6" id="productList">
            {/* Product items will be dynamically added here */}
          </div>

          <div class="flex flex-col sm:flex-row gap-4 justify-center mt-8 mb-6">
            <button class="btn-outline group" id="addProduct">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 transition-transform group-hover:rotate-90">
                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5V4.75z" />
              </svg>
              ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            </button>
            <button class="btn-primary" id="calculate">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-.75-4.75a.75.75 0 001.5 0V8.66l1.95 2.1a.75.75 0 101.1-1.02l-3.25-3.5a.75.75 0 00-1.1 0L6.2 9.74a.75.75 0 101.1 1.02l1.95-2.1v4.59z" clip-rule="evenodd" />
              </svg>
              ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
            </button>
          </div>

          {/* Results Section - initially hidden and animated in */}
          <div class="results results-transition opacity-0 transform translate-y-5 mt-10 hidden" id="results" aria-live="polite">
            <h2 class="text-xl sm:text-2xl font-semibold mb-6 text-primary-dark text-center">
              <span aria-hidden="true" class="mr-2">üìä</span>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
            </h2>
            <div class="overflow-x-auto shadow-md rounded-lg">
              <table class="w-full min-w-full text-sm text-left text-gray-700">
                <thead class="text-xs text-gray-700 uppercase bg-gray-200">
                  <tr>
                    <th scope="col" class="px-6 py-3">‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                    <th scope="col" class="px-6 py-3">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                    <th scope="col" class="px-6 py-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤</th>
                  </tr>
                </thead>
                <tbody id="resultsBody" class="bg-white"></tbody>
              </table>
            </div>

            <div class="summary mt-8 p-4 sm:p-6 bg-primary-light/10 border border-primary-light/30 rounded-lg text-center text-gray-700" id="summary">
              {/* Summary content here */}
            </div>
            <div class="recommendation mt-6 p-4 text-gray-600 bg-gray-50 rounded-lg text-center space-y-2" id="recommendation">
              {/* Recommendation content here */}
            </div>

            <div class="text-center mt-8">
                <button class="btn-copy" id="copyResults">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                        <path d="M15.502 1.94a.75.75 0 010 1.06L11.56 7.002H16.75a.75.75 0 010 1.5H11.56l3.942 3.942a.75.75 0 11-1.06 1.06L10 8.812l-4.442 4.442a.75.75 0 11-1.06-1.06L8.44 8.502H3.25a.75.75 0 010-1.5H8.44L4.5 3.002a.75.75 0 011.06-1.06L10 6.188l4.442-4.442a.75.75 0 011.06 0z" clip-rule="evenodd" />
                        <path d="M3.25 2.5a.75.75 0 00-.75.75v13.5a.75.75 0 00.75.75h13.5a.75.75 0 00.75-.75V9.25a.75.75 0 00-1.5 0v7.5H3.25v-13.5H10a.75.75 0 000-1.5H3.25z" />
                    </svg>
                    ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ú‡∏•‡∏™‡∏£‡∏∏‡∏õ
                </button>
            </div>
          </div>
        </div>
      </div>

      <footer class="mt-12 text-center text-xs sm:text-sm text-gray-500 py-6 border-t border-gray-200">
        <p>
          ¬© <span id="currentYear">2024</span>
          <a href="https://github.com/witchakornb/Smart-Price-Comparator" target="_blank" class="text-primary hover:underline font-medium">Smart Price Comparator</a>
          by WitchakornB. All rights reserved.
        </p>
      </footer>
    </div>

    {/* Tailwind Helper CSS for buttons (can be inlined or in a <style> tag) */}
    <style>
      .btn-primary, .btn-outline, .btn-delete, .btn-copy {
        @apply py-2.5 px-5 text-sm font-medium focus:outline-none rounded-lg border focus:z-10 focus:ring-4 inline-flex items-center justify-center gap-2 transition-all shadow-sm;
      }
      .btn-primary {
        @apply text-white bg-primary hover:bg-primary-dark focus:ring-primary-light/50 border-primary;
      }
      .btn-outline {
        @apply text-primary hover:text-white border-primary hover:bg-primary focus:ring-primary-light/50 bg-white;
      }
      .btn-delete {
         @apply text-white bg-red-600 hover:bg-red-700 focus:ring-red-300 border-red-600 p-2.5; /* More padding for icon button */
      }
      .btn-delete svg { @apply w-5 h-5; }
      .btn-copy {
        @apply text-white bg-green-600 hover:bg-green-700 focus:ring-green-300 border-green-600;
      }
      .btn-copy.copied {
         @apply bg-green-700;
      }
    </style>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const productList = document.getElementById("productList");
        const addProductBtn = document.getElementById("addProduct");
        const calculateBtn = document.getElementById("calculate");
        const copyResultsBtn = document.getElementById("copyResults");
        const resultsSection = document.getElementById("results");
        const resultsBody = document.getElementById("resultsBody");
        const summaryDiv = document.getElementById("summary");
        const recommendationDiv = document.getElementById("recommendation");
        const errorMessageArea = document.getElementById("errorMessageArea");
        document.getElementById("currentYear").textContent = new Date().getFullYear();


        let productCount = 0;
        const originalCopyBtnText = copyResultsBtn.innerHTML;

        const inputBaseClasses = 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary focus:border-primary block w-full p-2.5 input-number-placeholder';
        const inputErrorClasses = 'bg-red-50 border-red-500 text-red-900 placeholder-red-700 focus:ring-red-500 focus:border-red-500';


        function showErrorMessage(message) {
            errorMessageArea.textContent = message;
            errorMessageArea.classList.remove('hidden');
        }

        function clearErrorMessage() {
            errorMessageArea.classList.add('hidden');
            errorMessageArea.textContent = '';
        }

        function createProductItem() {
          productCount++;
          const div = document.createElement("div");
          // Added 'product-item-container' for easier targeting if needed, though not strictly necessary with Tailwind
          div.className = "product-item-container bg-gray-50 p-4 sm:p-5 rounded-lg border border-gray-200 shadow-sm grid grid-cols-1 md:grid-cols-[3fr_2fr_2fr_auto] gap-4 items-end";
          div.innerHTML = `
            <div>
              <label for="brand-${productCount}" class="block mb-1.5 text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå</label>
              <input type="text" id="brand-${productCount}" class="brand ${inputBaseClasses}" value="‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${productCount}" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏Ñ‡πâ‡∏Å, ‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå A">
            </div>
            <div>
              <label for="price-${productCount}" class="block mb-1.5 text-sm font-medium text-gray-700">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
              <input type="number" id="price-${productCount}" class="price ${inputBaseClasses}" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50.00" min="0.01" step="0.01">
            </div>
            <div>
              <label for="quantity-${productCount}" class="block mb-1.5 text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏´‡∏ô‡πà‡∏ß‡∏¢)</label>
              <input type="number" id="quantity-${productCount}" class="quantity ${inputBaseClasses}" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1.5 (‡∏•‡∏¥‡∏ï‡∏£), 6 (‡∏ä‡∏¥‡πâ‡∏ô)" min="0.001" step="any">
            </div>
            <button type="button" class="btn-delete product-delete-btn" aria-label="‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.58.177-2.34.294a.75.75 0 00-.512 1.064l.162.285a.75.75 0 00.874.447l.02-.006a25.046 25.046 0 014.362-.254V15.5A2.5 2.5 0 0010.75 18h3.5A2.5 2.5 0 0016.75 15.5V6.25a.75.75 0 00-.75-.75h-.599A25.046 25.046 0 0111.25 5V3.75A2.75 2.75 0 008.75 1zm-.25 2.75V5h3V3.75a1.25 1.25 0 00-1.25-1.25h-.5A1.25 1.25 0 008.5 3.75z" clip-rule="evenodd" />
              </svg>
              <span class="sr-only">‡∏•‡∏ö</span>
            </button>
          `;
          setTimeout(() => {
            const firstInput = div.querySelector('input.brand');
            if (firstInput) firstInput.focus();
          },0);
          return div;
        }

        function addProduct() {
          clearErrorMessage();
          productList.appendChild(createProductItem());
          resultsSection.classList.add("opacity-0", "translate-y-5", "hidden");
          resultsSection.classList.remove("opacity-100", "translate-y-0");
        }

        productList.addEventListener('click', function(event) {
            const deleteButton = event.target.closest('.product-delete-btn');
            if (deleteButton) {
                deleteButton.closest('.product-item-container').remove();
                if (productList.children.length === 0) {
                    resultsSection.classList.add("opacity-0", "translate-y-5", "hidden");
                    resultsSection.classList.remove("opacity-100", "translate-y-0");
                    clearErrorMessage();
                }
            }
        });

        function setInputValid(inputElement) {
            inputErrorClasses.split(' ').forEach(cls => inputElement.classList.remove(cls));
            inputBaseClasses.split(' ').forEach(cls => { // Ensure base classes are there
                if (!inputElement.classList.contains(cls)) inputElement.classList.add(cls);
            });
        }

        function setInputError(inputElement) {
            inputBaseClasses.split(' ').forEach(cls => inputElement.classList.remove(cls));
            inputErrorClasses.split(' ').forEach(cls => {
                 if (!inputElement.classList.contains(cls)) inputElement.classList.add(cls);
            });
        }


        function calculate() {
          clearErrorMessage();
          const items = document.querySelectorAll(".product-item-container"); // Changed selector
          const products = [];
          let hasError = false;

          items.forEach((item, index) => {
            const brandInput = item.querySelector(".brand");
            const priceInput = item.querySelector(".price");
            const quantityInput = item.querySelector(".quantity");

            const brand = brandInput.value.trim();
            const price = parseFloat(priceInput.value);
            const quantity = parseFloat(quantityInput.value);

            setInputValid(brandInput);
            setInputValid(priceInput);
            setInputValid(quantityInput);

            if (!brand) {
                setInputError(brandInput); hasError = true;
            }
            if (isNaN(price) || price <= 0) {
                setInputError(priceInput); hasError = true;
            }
            if (isNaN(quantity) || quantity <= 0) {
                setInputError(quantityInput); hasError = true;
            }

            if (!hasError && brand && !isNaN(price) && price > 0 && !isNaN(quantity) && quantity > 0) {
              products.push({
                brand, price, quantity,
                unitPrice: price / quantity,
                originalIndex: index
              });
            } else if (hasError && products.length > 0 && index === items.length -1) {
                // If an error occurs, ensure we clear any previously collected products if this error means no valid products overall
            }
          });

          if (hasError) {
            showErrorMessage("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á (‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå, ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0)");
            resultsSection.classList.add("opacity-0", "translate-y-5", "hidden");
            resultsSection.classList.remove("opacity-100", "translate-y-0");
            return;
          }

          if (products.length === 0) {
            showErrorMessage("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
            resultsSection.classList.add("opacity-0", "translate-y-5", "hidden");
            resultsSection.classList.remove("opacity-100", "translate-y-0");
            return;
          }

          const sortedByUnitPrice = [...products].sort((a, b) => a.unitPrice - b.unitPrice);
          const bestValueProduct = sortedByUnitPrice[0];
          const bestPrice = bestValueProduct.unitPrice;
          let nextBestPrice = null;

          for (let i = 1; i < sortedByUnitPrice.length; i++) {
            if (sortedByUnitPrice[i].unitPrice > bestPrice) {
              nextBestPrice = sortedByUnitPrice[i].unitPrice;
              break;
            }
          }

          resultsBody.innerHTML = "";
          const displayProducts = [...products].sort((a,b) => a.originalIndex - b.originalIndex);

          displayProducts.forEach((prod) => {
            let valueText = "-";
            let emoji = "";
            let trClasses = "border-b hover:bg-gray-50";
            let tdNameClasses = "px-6 py-4 font-medium text-gray-900 whitespace-nowrap";
            let tdOtherClasses = "px-6 py-4";


            if (prod.unitPrice === bestPrice) {
              emoji = "üèÜ ";
              valueText = "‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î";
              trClasses = "border-b bg-green-50 hover:bg-green-100";
              tdNameClasses = "px-6 py-4 font-semibold text-green-700 whitespace-nowrap";
            } else if (nextBestPrice && prod.unitPrice === nextBestPrice) {
              emoji = "ü•à ";
              valueText = "‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ñ‡∏±‡∏î‡∏°‡∏≤";
              trClasses = "border-b bg-blue-50 hover:bg-blue-100";
              tdNameClasses = "px-6 py-4 font-medium text-blue-700 whitespace-nowrap";
            }

            const row = document.createElement("tr");
            row.className = trClasses;
            row.innerHTML = `
              <td class="${tdNameClasses}">${emoji}${prod.brand}</td>
              <td class="${tdOtherClasses}">${prod.unitPrice.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ‡∏ö‡∏≤‡∏ó</td>
              <td class="${tdOtherClasses}">${valueText}</td>
            `;
            resultsBody.appendChild(row);
          });

          const bestValueItems = sortedByUnitPrice.filter(p => p.unitPrice === bestPrice);
          const bestNames = bestValueItems.map(p => p.brand).join(" ‡πÅ‡∏•‡∏∞ ");
          summaryDiv.innerHTML = `
            <p class="text-base sm:text-lg">
              ‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå‡∏ó‡∏µ‡πà <strong class="font-semibold text-primary-dark">‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</strong> ‡∏Ñ‡∏∑‡∏≠ <strong class="font-semibold text-primary-dark">${bestNames}</strong>
              ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ <strong class="font-semibold text-primary-dark">${bestPrice.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong> ‡∏ö‡∏≤‡∏ó
            </p>
          `;

          const mainBest = bestValueItems[0];
          let recommendationHTML = `
            <p>
              ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏ã‡∏∑‡πâ‡∏≠ <strong class="font-medium text-gray-800">${mainBest.quantity.toLocaleString()}</strong> ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ç‡∏≠‡∏á <strong class="font-medium text-gray-800">${mainBest.brand}</strong>
              ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <strong class="font-medium text-gray-800">${mainBest.price.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong> ‡∏ö‡∏≤‡∏ó.
            </p>
          `;

          if (nextBestPrice) {
            const nextBestItems = sortedByUnitPrice.filter(p => p.unitPrice === nextBestPrice);
            if (nextBestItems.length > 0) {
                const nextBestItem = nextBestItems[0];
                const diffPerUnit = nextBestItem.unitPrice - mainBest.unitPrice;
                if (diffPerUnit > 0.001) { // Check for meaningful difference
                    const savingsPerUnitForBest = diffPerUnit;
                    const totalSavingsForBest = savingsPerUnitForBest * mainBest.quantity;
                    recommendationHTML += `
                    <p>
                        ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö <strong class="font-medium text-gray-800">${nextBestItem.brand}</strong> (‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ ${nextBestItem.unitPrice.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ‡∏ö‡∏≤‡∏ó),
                        ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <strong class="font-medium text-gray-800">${mainBest.brand}</strong> ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÑ‡∏î‡πâ
                        <strong class="font-medium text-green-600">${savingsPerUnitForBest.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong> ‡∏ö‡∏≤‡∏ó‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢.
                    </p>
                    <p>
                        ‡∏´‡∏≤‡∏Å‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô <strong class="font-medium text-gray-800">${mainBest.quantity.toLocaleString()}</strong> ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô,
                        ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ñ‡∏∂‡∏á <strong class="font-medium text-green-600">${totalSavingsForBest.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong> ‡∏ö‡∏≤‡∏ó.
                    </p>`;
                }
            }
          } else if (products.length > 1 && bestValueItems.length === products.length) {
            recommendationHTML += `<p>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô!</p>`;
          } else if (products.length === 1) {
             recommendationHTML += `<p>‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÉ‡∏´‡πâ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤.</p>`;
          }

          recommendationDiv.innerHTML = recommendationHTML;
          resultsSection.classList.remove("hidden", "opacity-0", "translate-y-5");
          resultsSection.classList.add("opacity-100", "translate-y-0");
          resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        copyResultsBtn.addEventListener("click", () => {
          const tableRows = Array.from(resultsBody.querySelectorAll("tr"));
          let tableText = "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤:\n";
          tableRows.forEach(row => {
              const cells = Array.from(row.querySelectorAll("td"));
              tableText += `${cells[0].textContent.trim()} | ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${cells[1].textContent.trim()} | ${cells[2].textContent.trim()}\n`;
          });

          const summaryText = summaryDiv.textContent.replace(/\s+/g, " ").trim();
          const recommendationText = recommendationDiv.textContent.replace(/\s+/g, " ").trim();
          const fullText = `${tableText}\n‡∏™‡∏£‡∏∏‡∏õ:\n${summaryText}\n\n‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:\n${recommendationText}`;
          
          navigator.clipboard.writeText(fullText)
            .then(() => {
              copyResultsBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                  <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
                </svg>
                ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!`;
              copyResultsBtn.classList.add('copied');
              setTimeout(() => {
                copyResultsBtn.innerHTML = originalCopyBtnText;
                copyResultsBtn.classList.remove('copied');
              }, 2500);
            })
            .catch((err) => {
              showErrorMessage("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÑ‡∏î‡πâ: " + err.message);
              console.error("Error copying text: ", err);
            });
        });

        addProductBtn.addEventListener("click", addProduct);
        calculateBtn.addEventListener("click", calculate);

        addProduct();
        addProduct();
      });
    </script>
  </body>
</html>
